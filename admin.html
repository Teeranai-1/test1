<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container mt-5">

    <!-- Login -->
    <div id="loginBox" class="card p-4 shadow login-box">
        <h4 class="text-center mb-3">เข้าสู่ระบบแอดมิน</h4>
        <input id="user" class="form-control mb-2" placeholder="Username">
        <input id="pass" type="password" class="form-control mb-3" placeholder="Password">
        <button class="btn btn-dark w-100" onclick="login()">Login</button>
    </div>

    <!-- Admin -->
    <div id="adminPanel" style="display:none">

        <h3 class="mb-3">สรุปจำนวน</h3>
        <div class="row mb-4" id="summary"></div>

        <div id="tables"></div>

        <button class="btn btn-secondary mt-3" onclick="logout()">Logout</button>
    </div>

</div>

<script>
const ADMIN_USER = "admin";
const ADMIN_PASS = "1234";

const courses = [
    "วิศวกรรมคอมพิวเตอร์",
    "วิศวกรรมโลจิสติกส์",
    "วิศวกรรมการจัดการพลังงานในงานอุตสาหกรรม",
    "วิศวกรรมบริหารงานก่อสร้าง",
    "เทคโนโลยีไฟฟ้า",
    "เทคโนโลยีคอมพิวเตอร์เพื่อการออกแบบ",
    "เทคโนโลยีอุตสาหการ",
    "เทคโนโลยีสำรวจและภูมิสารสนเทศ",
    
];

function login(){
    if(user.value === ADMIN_USER && pass.value === ADMIN_PASS){
        loginBox.style.display = "none";
        adminPanel.style.display = "block";
        loadData();
    } else {
        alert("รหัสไม่ถูกต้อง");
    }
}

function loadData(){
    let students = JSON.parse(localStorage.getItem("students") || "[]");

    // ===== Summary =====
    let sumHTML = "";
    courses.forEach(c => {
        let count = students.filter(s => s.course === c).length;
        sumHTML += `
        <div class="col-md-4">
            <div class="card text-center p-3 shadow-sm">
                <h5>${c}</h5>
                <h2 class="text-primary">${count}</h2>
                <small>คน</small>
            </div>
        </div>`;
    });
    summary.innerHTML = sumHTML;

    // ===== Tables =====
    let tableHTML = "";
    courses.forEach(c => {
        let list = students.filter(s => s.course === c);

        tableHTML += `
        <div class="card shadow mb-4">
            <div class="card-header bg-success text-white">
                ${c}
            </div>
            <div class="card-body">
                <table class="table table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>ชื่อ</th>
                            <th>Email</th>
                            <th>โทร</th>
                            <th>ลบ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${list.map((s,i)=>`
                        <tr>
                            <td>${s.fullname}</td>
                            <td>${s.email}</td>
                            <td>${s.phone}</td>
                            <td>
                                <button class="btn btn-danger btn-sm"
                                onclick="deleteStudent('${c}',${i})">
                                ลบ
                                </button>
                            </td>
                        </tr>`).join("")}
                    </tbody>
                </table>
            </div>
        </div>`;
    });

    tables.innerHTML = tableHTML;
}

function deleteStudent(course, index){
    if(confirm("ยืนยันการลบข้อมูล?")){
        let students = JSON.parse(localStorage.getItem("students") || "[]");
        let group = students.filter(s => s.course === course);
        group.splice(index,1);
        let others = students.filter(s => s.course !== course);
        localStorage.setItem("students", JSON.stringify(others.concat(group)));
        loadData();
    }
}

function logout(){
    location.reload();
}
</script>

</body>
</html>
